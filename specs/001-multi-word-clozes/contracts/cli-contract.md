# CLI Contract: anki-cloze

**Version**: 1.0.0  
**Date**: 2026-01-11

## Command Interface

### Synopsis
```bash
anki-cloze [SENTENCE]
anki-cloze < input.txt
echo "sentence" | anki-cloze
```

### Description
Generates Anki cloze deletion flashcards from a plain text sentence. Automatically creates all possible N-word cloze deletions for N from 1 to ceil(word_count/2), with all non-overlapping arrangements.

---

## Input Contract

### Command-Line Argument (Primary)
**Parameter**: `SENTENCE` (String, optional)  
**Description**: The sentence to generate clozes from

**Format**:
- Plain text string
- May contain punctuation, contractions, hyphenated words
- Whitespace used as word delimiter

**Example**:
```bash
anki-cloze "The quick brown fox"
```

### Standard Input (Fallback)
**Description**: If no argument provided, read sentence from stdin  
**Format**: Same as command-line argument

**Example**:
```bash
echo "The quick brown fox" | anki-cloze
```

**Priority**: If both argument and stdin available, argument takes precedence

---

## Output Contract

### Standard Output (stdout)

**Format**: One line per arrangement, in Anki cloze deletion format

**Line Format**:
```text
{{c1::word1 word2...}} remaining {{c2::wordN wordM...}} text
```

**Specifications**:
- Each line represents one flashcard/arrangement
- Multiple clozes on same line use incrementing numbers: `{{c1::...}}`, `{{c2::...}}`, etc.
- Words within cloze separated by single space
- Preserve original punctuation and spacing
- No leading/trailing whitespace on lines
- Lines separated by `\n` (Unix line ending)

**Ordering**: 
1. Group by chunk size N (N=1 first, then N=2, etc.)
2. Within each N, arrangements in generation order

**Example Output**:
```text
{{c1::The}} quick brown fox
The {{c1::quick}} brown fox
The quick {{c1::brown}} fox
The quick brown {{c1::fox}}
{{c1::The quick}} {{c2::brown fox}}
```

### Standard Error (stderr)

**Description**: Error messages and diagnostics only

**Format**: Human-readable error messages

**Error Scenarios**:
- Empty input: "Error: Input sentence cannot be empty"
- Only whitespace: "Error: Input sentence must contain words"

---

## Exit Codes

| Code | Meaning | Condition |
|------|---------|-----------|
| 0 | Success | Cloze cards generated successfully |
| 1 | Input Error | Invalid or empty input |
| 2 | Runtime Error | Unexpected error during generation |

---

## Examples

### Example 1: Simple 4-word sentence
```bash
$ anki-cloze "The quick brown fox"
{{c1::The}} quick brown fox
The {{c1::quick}} brown fox
The quick {{c1::brown}} fox
The quick brown {{c1::fox}}
{{c1::The quick}} {{c2::brown fox}}
```

**Exit Code**: 0

### Example 2: Pipeline input
```bash
$ echo "It's a well-known fact" | anki-cloze
{{c1::It's}} a well-known fact
It's {{c1::a}} well-known fact
It's a {{c1::well-known}} fact
It's a well-known {{c1::fact}}
{{c1::It's a}} {{c2::well-known fact}}
```

**Exit Code**: 0

### Example 3: Error - empty input
```bash
$ anki-cloze ""
Error: Input sentence cannot be empty
```

**Exit Code**: 1

### Example 4: 5-word sentence with multiple N values
```bash
$ anki-cloze "one two three four five"
{{c1::one}} two three four five
one {{c1::two}} three four five
one two {{c1::three}} four five
one two three {{c1::four}} five
one two three four {{c1::five}}
{{c1::one two}} {{c2::three four}} five
one {{c1::two three}} {{c2::four five}}
{{c1::one two three}} four five
one {{c1::two three four}} five
one two {{c1::three four five}}
```

**Exit Code**: 0

---

## Behavioral Specifications

### Word Boundary Rules
- **Whitespace splitting**: Any whitespace sequence delimits words
- **Contractions**: Treated as single word (e.g., "don't" = 1 word)
- **Hyphens**: Treated as single word (e.g., "well-known" = 1 word)
- **Punctuation**: Preserved within words (e.g., "fact," keeps comma)

### Chunk Size Calculation
- **Formula**: max_chunk_size = ceil(word_count / 2)
- **Range**: Generate clozes for N = 1, 2, ..., max_chunk_size

**Examples**:
- 3 words → max N = 2 (generate N=1, N=2)
- 4 words → max N = 2 (generate N=1, N=2)
- 5 words → max N = 3 (generate N=1, N=2, N=3)
- 6 words → max N = 3 (generate N=1, N=2, N=3)

### Non-Overlapping Arrangements
- Each word appears in at most one cloze per line
- Multiple arrangements generated by shifting chunk positions
- All chunks on same line must have same size N

---

## Testing Contract

### Test Inputs
Implementations should pass these test cases:

1. **Minimum**: "word" → 1 cloze line
2. **Even words**: "The quick brown fox" → 5 lines (4 for N=1, 1 for N=2)
3. **Odd words**: "one two three" → 4 lines (3 for N=1, 1 for N=2)
4. **Punctuation**: "It's raining" → 2 lines for N=1
5. **Five words**: "one two three four five" → 10 lines (5 + 2 + 3)

### Validation
- Output must be valid Anki cloze format
- Each line must be importable into Anki without errors
- Word count and spacing must match input exactly

---

## Non-Functional Requirements

### Performance
- Process sentences up to 20 words in < 100ms
- No memory leaks for repeated invocations

### Compatibility
- Works on Linux, macOS, Windows with Ruby 3.2+
- No external dependencies beyond Ruby stdlib
- Follows Unix conventions (stdin/stdout/stderr)

### Reliability
- Deterministic output for same input
- Graceful error handling with clear messages
- No crashes on invalid input
